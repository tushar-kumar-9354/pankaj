{% extends "admin/base.html" %}

{% block content %}
<div id="content-main">
    <h1>Booking Management</h1>
    
    <!-- Statistics Dashboard -->
    <div class="module" style="margin: 20px 0; padding: 20px; background: #f8f9fa;">
        <h2>Booking Statistics</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div class="card" style="background: #007bff; color: white; padding: 15px; border-radius: 5px;">
                <h3>Total Bookings</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">{{ stats.total }}</p>
            </div>
            <div class="card" style="background: #28a745; color: white; padding: 15px; border-radius: 5px;">
                <h3>Confirmed</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">{{ stats.confirmed }}</p>
            </div>
            <div class="card" style="background: #ffc107; color: black; padding: 15px; border-radius: 5px;">
                <h3>Pending</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">{{ stats.pending }}</p>
            </div>
            <div class="card" style="background: #dc3545; color: white; padding: 15px; border-radius: 5px;">
                <h3>Cancelled</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">{{ stats.cancelled }}</p>
            </div>
            <div class="card" style="background: #6c757d; color: white; padding: 15px; border-radius: 5px;">
                <h3>Completed</h3>
                <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">{{ stats.completed }}</p>
            </div>
        </div>
    </div>
    
    <!-- Filters -->
    <div class="module" style="margin: 20px 0; padding: 20px;">
        <h2>Filters</h2>
        <form method="get" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
            <div>
                <label for="status" style="display: block; margin-bottom: 5px; font-weight: bold;">Status:</label>
                <select name="status" id="status" style="width: 100%; padding: 8px;">
                    <option value="">All Statuses</option>
                    <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
                    <option value="confirmed" {% if status_filter == 'confirmed' %}selected{% endif %}>Confirmed</option>
                    <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Completed</option>
                    <option value="cancelled" {% if status_filter == 'cancelled' %}selected{% endif %}>Cancelled</option>
                </select>
            </div>
            <div>
                <label for="date" style="display: block; margin-bottom: 5px; font-weight: bold;">Date:</label>
                <input type="date" name="date" id="date" value="{{ date_filter }}" style="width: 100%; padding: 8px;">
            </div>
            <div>
                <button type="submit" class="button" style="background: #417690; color: white; padding: 8px 15px; border: none; cursor: pointer;">
                    Filter
                </button>
                <a href="{% url 'admin_booking_management' %}" class="button" style="background: #6c757d; color: white; padding: 8px 15px; text-decoration: none; display: inline-block;">
                    Clear
                </a>
            </div>
        </form>
    </div>
    
    <!-- Bookings Table -->
    <div class="module">
        <table style="width: 100%;">
            <thead>
                <tr>
                    <th>Booking ID</th>
                    <th>Client</th>
                    <th>Date & Time</th>
                    <th>Duration</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for booking in bookings %}
                <tr class="{% cycle 'row1' 'row2' %}">
                    <td>{{ booking.booking_id|truncatechars:12 }}</td>
                    <td>
                        <strong>{{ booking.name }}</strong><br>
                        <small>{{ booking.email }}</small><br>
                        <small>{{ booking.phone }}</small>
                    </td>
                    <td>
                        {{ booking.appointment_date }}<br>
                        <small>{{ booking.appointment_time|time:"H:i" }}</small>
                    </td>
                    <td>{{ booking.get_duration_display }}</td>
                    <td>
                        <span class="status-badge status-{{ booking.status }}">
                            {{ booking.get_status_display }}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            {% if booking.status != 'cancelled' %}
                            <a href="{% url 'admin_cancel_booking' booking.booking_id %}" 
                               class="button" 
                               style="background: #dc3545; color: white; padding: 3px 8px; text-decoration: none; font-size: 11px; margin: 2px;">
                                Cancel
                            </a>
                            {% endif %}
                            <a href="/admin/pankaj/consultationbooking/{{ booking.id }}/change/" 
                               class="button" 
                               style="background: #417690; color: white; padding: 3px 8px; text-decoration: none; font-size: 11px; margin: 2px;">
                                Edit
                            </a>
                            <a href="mailto:{{ booking.email }}" 
                               class="button" 
                               style="background: #17a2b8; color: white; padding: 3px 8px; text-decoration: none; font-size: 11px; margin: 2px;">
                                Email
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: 20px;">No bookings found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Quick Actions -->
    <div class="module" style="margin-top: 20px; padding: 20px;">
        <h2>Quick Actions</h2>
        <div style="display: flex; gap: 10px;">
            <a href="/admin/pankaj/consultationbooking/" class="button" style="background: #417690; color: white; padding: 10px 15px; text-decoration: none;">
                View All in Admin
            </a>
            <a href="/admin/pankaj/consultationbooking/add/" class="button" style="background: #28a745; color: white; padding: 10px 15px; text-decoration: none;">
                Create New Booking
            </a>
            <a href="/admin/pankaj/consultationbooking/?status__exact=cancelled" class="button" style="background: #dc3545; color: white; padding: 10px 15px; text-decoration: none;">
                View Cancelled Bookings
            </a>
        </div>
    </div>
</div>

<style>
    .module {
        border: 1px solid #ddd;
        margin-bottom: 20px;
        background: white;
    }
    
    .module h2 {
        margin: 0;
        padding: 8px;
        font-size: 13px;
        text-align: left;
        font-weight: 400;
        background: #79aec8;
        color: #fff;
    }
    
    table {
        border-collapse: collapse;
        width: 100%;
    }
    
    table th {
        padding: 8px;
        background: #f5f5f5;
        border-bottom: 1px solid #ddd;
        text-align: left;
        font-weight: bold;
    }
    
    table td {
        padding: 8px;
        border-bottom: 1px solid #eee;
    }
    
    .row1 {
        background: #fff;
    }
    
    .row2 {
        background: #f9f9f9;
    }
    
    .button {
        border: none;
        cursor: pointer;
        display: inline-block;
    }
    
    .action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }
    
    /* ── Status Badge Styles ── */
    .status-badge {
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 11px;
        font-weight: bold;
        display: inline-block;
        min-width: 70px;
        text-align: center;
    }
    
    .status-pending {
        background: #ffc107;
        color: black;
    }
    
    .status-confirmed {
        background: #28a745;
        color: white;
    }
    
    .status-cancelled {
        background: #dc3545;
        color: white;
    }
    
    .status-completed {
        background: #6c757d;
        color: white;
    }
</style>
{% endblock %}