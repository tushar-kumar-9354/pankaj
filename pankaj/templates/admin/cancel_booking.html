{% extends "admin/base.html" %}

{% block content %}
<div id="content-main">
    <h1>Cancel Booking</h1>
    
    <div class="module" style="margin: 20px 0;">
        <h2>Booking Details</h2>
        <div style="padding: 15px;">
            <table style="width: 100%;">
                <tr>
                    <td style="width: 150px; font-weight: bold;">Booking ID:</td>
                    <td>{{ booking.booking_id }}</td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">Client:</td>
                    <td>{{ booking.name }}</td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">Email:</td>
                    <td>{{ booking.email }}</td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">Phone:</td>
                    <td>{{ booking.phone }}</td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">Appointment:</td>
                    <td>{{ booking.appointment_date }} at {{ booking.appointment_time|time:"H:i" }}</td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">Duration:</td>
                    <td>{{ booking.get_duration_display }}</td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">Topic:</td>
                    <td>{{ booking.topic|truncatechars:100 }}</td>
                </tr>
            </table>
        </div>
    </div>
    
    <div class="module" style="margin: 20px 0;">
        <h2>Cancellation Form</h2>
        <form method="post" style="padding: 15px;">
            {% csrf_token %}
            
            <div style="margin-bottom: 20px;">
                <label for="reason" style="display: block; margin-bottom: 8px; font-weight: bold;">
                    Cancellation Reason (will be sent to client):
                </label>
                <textarea name="reason" id="reason" rows="4" 
                          style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"
                          placeholder="Please provide a reason for cancellation..."></textarea>
                <p style="color: #666; font-size: 12px; margin-top: 5px;">
                    This reason will be included in the cancellation email sent to the client.
                </p>
            </div>
            
            <div style="background: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 20px 0;">
                <h3 style="margin-top: 0; color: #856404;">⚠️ Important Note:</h3>
                <ul style="color: #856404;">
                    <li>A cancellation email will be automatically sent to {{ booking.email }}</li>
                    <li>The booking status will be updated to "Cancelled"</li>
                    <li>The time slot will be made available for other bookings</li>
                    <li>This action cannot be undone</li>
                </ul>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="submit" 
                        class="button" 
                        style="background: #dc3545; color: white; padding: 10px 20px; border: none; cursor: pointer;"
                        onclick="return confirm('Are you sure you want to cancel this booking? A cancellation email will be sent to the client.')">
                    Confirm Cancellation
                </button>
                <a href="{% url 'admin_booking_management' %}" 
                   class="button" 
                   style="background: #6c757d; color: white; padding: 10px 20px; text-decoration: none;">
                    Go Back
                </a>
            </div>
        </form>
    </div>
    
    <div class="module" style="margin: 20px 0;">
        <h2>Email Preview</h2>
        <div style="padding: 15px; background: #f8f9fa; border: 1px dashed #ccc;">
            <p><strong>To:</strong> {{ booking.email }}</p>
            <p><strong>Subject:</strong> Consultation Booking Cancelled - {{ booking.booking_id }}</p>
            <p><strong>Body will include:</strong></p>
            <ul>
                <li>Booking ID: {{ booking.booking_id }}</li>
                <li>Original appointment details</li>
                <li>The cancellation reason you provide above</li>
                <li>Next steps for rescheduling</li>
                <li>Contact information</li>
            </ul>
        </div>
    </div>
</div>

<style>
    .module {
        border: 1px solid #ddd;
        background: white;
    }
    
    .module h2 {
        margin: 0;
        padding: 8px;
        font-size: 13px;
        text-align: left;
        font-weight: 400;
        background: #79aec8;
        color: #fff;
    }
    
    textarea {
        font-family: monospace;
    }
    
    .button {
        border-radius: 4px;
    }
</style>
{% endblock %}