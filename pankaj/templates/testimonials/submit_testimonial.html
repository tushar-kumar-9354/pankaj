{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Testimonial | Anjali Bansal & Associates</title>
    <link rel="stylesheet" href="{% static 'css/testimonials.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap">
    <style>
        /* Additional styles for testimonial submission page */
        .testimonial-submission-hero {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 100px 0 60px;
            position: relative;
            overflow: hidden;
        }
        
        .testimonial-submission-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("{% static 'img/testimonial-bg.jpg' %}") center/cover;
            opacity: 0.1;
        }
        
        .testimonial-header-content {
            text-align: center;
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .testimonial-header-content h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            margin-bottom: 20px;
            color: white;
        }
        
        .testimonial-header-content p.lead {
            font-size: 1.2rem;
            opacity: 0.9;
            line-height: 1.6;
        }
        
        .steps-indicator {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        .step-item {
            text-align: center;
            flex: 1;
            min-width: 150px;
            max-width: 200px;
        }
        
        .step-icon {
            width: 70px;
            height: 70px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .step-icon i {
            font-size: 1.8rem;
        }
        
        .form-container-wrapper {
            background: #f8f9fa;
            padding: 60px 0;
        }
        
        .form-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 900px;
            margin: 0 auto;
        }
        
        .form-section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid #eee;
        }
        
        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .section-title {
            color: #2c3e50;
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        .section-title i {
            color: #3498db;
        }
        
        .form-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            display: block;
        }
        
        .form-label.required::after {
            content: ' *';
            color: #e74c3c;
        }
        
        .rating-container {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-direction: row-reverse;
        }
        
        .rating-stars input[type="radio"] {
            display: none;
        }
        
        .rating-stars label {
            color: #ddd;
            font-size: 2.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .rating-stars input[type="radio"]:checked ~ label,
        .rating-stars label:hover,
        .rating-stars label:hover ~ label {
            color: #ffc107;
        }
        
        .rating-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }
        
        .character-count {
            font-size: 0.9rem;
            color: #666;
            text-align: right;
            margin-top: 5px;
        }
        
        .character-count.warning {
            color: #f39c12;
        }
        
        .character-count.error {
            color: #e74c3c;
        }
        
        .character-count.success {
            color: #27ae60;
        }
        
        .terms-check {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .form-check-input:checked {
            background-color: #3498db;
            border-color: #3498db;
        }
        
        .services-checklist {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .services-checklist .form-check {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 0;
        }
        
        .btn-submit-container {
            text-align: center;
            margin-top: 40px;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
            color: white;
        }
        
        .btn-back {
            background: transparent;
            border: 2px solid #3498db;
            color: #3498db;
            padding: 12px 30px;
            border-radius: 50px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }
        
        .btn-back:hover {
            background: #3498db;
            color: white;
        }
        
        .image-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin-top: 10px;
            border: 3px solid #3498db;
            display: none;
        }
        
        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .help-text {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .testimonial-submission-hero {
                padding: 80px 0 40px;
            }
            
            .testimonial-header-content h1 {
                font-size: 2.2rem;
            }
            
            .form-container {
                padding: 25px;
                margin: 0 15px;
            }
            
            .steps-indicator {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            
            .step-item {
                max-width: 100%;
                min-width: 200px;
            }
            
            .services-checklist {
                grid-template-columns: 1fr;
            }
            
            .rating-stars label {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <h1>ANJALI BANSAL & ASSOCIATES</h1>
                <p>COMPANY SECRETARIES</p>
            </div>
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <nav class="nav-menu" id="navMenu">
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/about">About</a></li>
                    <li><a href="/our_expertise">Expertise</a></li>
                    <li><a href="/#articles">Articles</a></li>
                    <li><a href="/testimonials">Testimonials</a></li>
                    <li><a href="/contact">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="testimonial-submission-hero">
        <div class="container">
            <div class="testimonial-header-content">
                <h1><i class="fas fa-comment-medical"></i> Share Your Experience</h1>
                <p class="lead">Your honest feedback helps us improve and guides future clients in making informed decisions about our services.</p>
                
                <div class="steps-indicator">
                    <div class="step-item">
                        <div class="step-icon">
                            <i class="fas fa-edit text-warning"></i>
                        </div>
                        <h4>Write Review</h4>
                        <p>Share your detailed experience</p>
                    </div>
                    <div class="step-item">
                        <div class="step-icon">
                            <i class="fas fa-search text-info"></i>
                        </div>
                        <h4>Review Process</h4>
                        <p>Our team verifies your submission</p>
                    </div>
                    <div class="step-item">
                        <div class="step-icon">
                            <i class="fas fa-check-circle text-success"></i>
                        </div>
                        <h4>Get Published</h4>
                        <p>Featured on testimonials page</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Form Section -->
    <section class="form-container-wrapper">
        <div class="container">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% else %}info-circle{% endif %} me-2"></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <div class="form-container">
                <form method="post" enctype="multipart/form-data" id="testimonialForm" novalidate>
                    {% csrf_token %}
                    
                    <!-- Personal Information -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-user-circle"></i> Personal Information
                        </h3>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label required">Full Name</label>
                                {{ form.full_name }}
                                {% if form.full_name.errors %}
                                <div class="text-danger small">{{ form.full_name.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <label class="form-label required">Email Address</label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                <div class="text-danger small">{{ form.email.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label">Phone Number</label>
                                {{ form.phone }}
                                {% if form.phone.errors %}
                                <div class="text-danger small">{{ form.phone.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <label class="form-label">Profile Photo (Optional)</label>
                                {{ form.profile_picture }}
                                <div class="help-text">Recommended: 400x400px, Max 2MB</div>
                                <div id="imagePreview" class="image-preview">
                                    <img id="previewImage" src="" alt="Preview">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Professional Information -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-briefcase"></i> Professional Information
                        </h3>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label required">Company Name</label>
                                {{ form.company_name }}
                                {% if form.company_name.errors %}
                                <div class="text-danger small">{{ form.company_name.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <label class="form-label required">Your Position</label>
                                {{ form.position }}
                                {% if form.position.errors %}
                                <div class="text-danger small">{{ form.position.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label required">Industry</label>
                            {{ form.industry }}
                            {% if form.industry.errors %}
                            <div class="text-danger small">{{ form.industry.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Services Used -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-cogs"></i> Services Used
                        </h3>
                        
                        <div class="mb-4">
                            <p class="form-label">Select the services you used (select all that apply):</p>
                            <div class="services-checklist">
                                {% for service in services %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" 
                                           name="services_used" value="{{ service.id }}" 
                                           id="service_{{ service.id }}"
                                           {% if service.id in form.services_used.value %}checked{% endif %}>
                                    <label class="form-check-label" for="service_{{ service.id }}">
                                        <strong>{{ service.name }}</strong>
                                        {% if service.description %}
                                        <br><small class="text-muted">{{ service.description|truncatechars:80 }}</small>
                                        {% endif %}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">Other Services (Optional)</label>
                            {{ form.other_services }}
                            <div class="help-text">Add any other services not listed above</div>
                        </div>
                    </div>

                    <!-- Rating -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-star"></i> Your Rating
                        </h3>
                        
                        <div class="rating-container">
                            <div class="rating-stars">
                                {% for i in "54321" %}
                                <input type="radio" id="star{{ i }}" name="rating" value="{{ i }}" 
                                       {% if form.rating.value == i or i == "5" and not form.rating.value %}checked{% endif %}>
                                <label for="star{{ i }}" title="{{ i }} star{{ i|pluralize }}">
                                    <i class="fas fa-star"></i>
                                </label>
                                {% endfor %}
                            </div>
                            <div class="rating-text">
                                Click on a star to rate your overall experience (5 = Excellent, 1 = Poor)
                            </div>
                            {% if form.rating.errors %}
                            <div class="text-danger small mt-2">{{ form.rating.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Testimonial Content -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-comment-dots"></i> Your Testimonial
                        </h3>
                        
                        <div class="mb-4">
                            <label class="form-label required">Share Your Experience</label>
                            {{ form.testimonial_text }}
                            <div class="character-count" id="charCount">
                                Minimum 100 characters required
                            </div>
                            {% if form.testimonial_text.errors %}
                            <div class="text-danger small mt-2">{{ form.testimonial_text.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Identity Preferences -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-user-shield"></i> Display Preferences
                        </h3>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="form-check form-switch">
                                    {{ form.is_anonymous }}
                                    <label class="form-check-label" for="id_is_anonymous">
                                        <strong>Post anonymously</strong><br>
                                        <small class="text-muted">
                                            Your name will be shown as "Anonymous Client" and your profile picture will be hidden.
                                        </small>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="form-check form-switch">
                                    {{ form.show_industry }}
                                    <label class="form-check-label" for="id_show_industry">
                                        <strong>Show my industry</strong><br>
                                        <small class="text-muted">
                                            Your industry will be displayed along with your testimonial.
                                        </small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Terms & Conditions -->
                    <div class="form-section">
                        <div class="terms-check">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" 
                                       name="terms_agreed" id="terms_agreed" required>
                                <label class="form-check-label" for="terms_agreed">
                                    <strong>I agree to the following terms:</strong><br>
                                    1. I confirm that this testimonial is based on my genuine experience.<br>
                                    2. I authorize Anjali Bansal & Associates to publish this testimonial.<br>
                                    3. I understand my testimonial may be edited for clarity.<br>
                                    4. I can request removal of my testimonial at any time.
                                </label>
                                <div class="invalid-feedback">You must agree to the terms and conditions.</div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="d-flex justify-content-between align-items-center mt-5">
                        <a href="{% url 'testimonials' %}" class="btn-back">
                            <i class="fas fa-arrow-left me-2"></i>Back to Testimonials
                        </a>
                        <button type="submit" class="btn-submit">
                            <i class="fas fa-paper-plane me-2"></i>Submit Testimonial
                        </button>
                    </div>
                </form>
            </div>

            <!-- Process Timeline -->
            <div class="row justify-content-center mt-5">
                <div class="col-lg-10">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-4">
                            <h4 class="text-center mb-4">
                                <i class="fas fa-info-circle text-primary me-2"></i>
                                What Happens After Submission?
                            </h4>
                            <div class="row text-center">
                                <div class="col-md-3 mb-3">
                                    <div class="p-3 rounded-circle bg-primary bg-opacity-10 d-inline-block mb-3">
                                        <i class="fas fa-envelope fa-2x text-primary"></i>
                                    </div>
                                    <h5>Email Confirmation</h5>
                                    <p class="text-muted">Instant confirmation sent</p>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="p-3 rounded-circle bg-warning bg-opacity-10 d-inline-block mb-3">
                                        <i class="fas fa-search fa-2x text-warning"></i>
                                    </div>
                                    <h5>Quality Review</h5>
                                    <p class="text-muted">Our team reviews within 2-3 days</p>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="p-3 rounded-circle bg-info bg-opacity-10 d-inline-block mb-3">
                                        <i class="fas fa-check-double fa-2x text-info"></i>
                                    </div>
                                    <h5>Approval</h5>
                                    <p class="text-muted">You'll be notified when approved</p>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="p-3 rounded-circle bg-success bg-opacity-10 d-inline-block mb-3">
                                        <i class="fas fa-globe-asia fa-2x text-success"></i>
                                    </div>
                                    <h5>Live on Website</h5>
                                    <p class="text-muted">Featured in testimonials section</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <h3>Anjali Bansal & Associates</h3>
                <p>Company Secretaries</p>
            </div>
            <div class="footer-links">
                <a href="/">Home</a>
                <a href="/about">About</a>
                <a href="/contact">Contact</a>
                <a href="/privacy_policy">Privacy Policy</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; {% now "Y" %} Anjali Bansal & Associates. All rights reserved.</p>
            <p class="footer-note">Your trusted partner in compliance and corporate governance</p>
        </div>
    </footer>

    <script>
        // Image preview
        function previewImage(input) {
            const preview = document.getElementById('previewImage');
            const previewContainer = document.getElementById('imagePreview');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    previewContainer.style.display = 'block';
                }
                
                reader.readAsDataURL(input.files[0]);
            } else {
                previewContainer.style.display = 'none';
            }
        }
        
        // Character count for testimonial text
        function updateCharacterCount(textarea) {
            const charCount = document.getElementById('charCount');
            const length = textarea.value.trim().length;
            
            charCount.textContent = `${length} characters`;
            
            if (length === 0) {
                charCount.className = 'character-count';
                charCount.textContent = 'Minimum 100 characters required';
            } else if (length < 100) {
                charCount.className = 'character-count error';
                charCount.innerHTML += ` - <strong>Need ${100 - length} more characters</strong>`;
            } else if (length < 200) {
                charCount.className = 'character-count warning';
                charCount.innerHTML += ' - Good start!';
            } else {
                charCount.className = 'character-count success';
                charCount.innerHTML += ' - Excellent!';
            }
        }
        
        // Form validation
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize character count
            const textarea = document.querySelector('textarea[name="testimonial_text"]');
            if (textarea) {
                updateCharacterCount(textarea);
                textarea.addEventListener('input', function() {
                    updateCharacterCount(this);
                });
            }
            
            // Image preview
            const fileInput = document.querySelector('input[name="profile_picture"]');
            if (fileInput) {
                fileInput.addEventListener('change', function() {
                    previewImage(this);
                });
            }
            
            // Form submission validation
            const form = document.getElementById('testimonialForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    // Check testimonial length
                    const testimonialText = document.querySelector('textarea[name="testimonial_text"]');
                    if (testimonialText && testimonialText.value.trim().length < 100) {
                        e.preventDefault();
                        testimonialText.focus();
                        alert('Please provide a detailed testimonial of at least 100 characters.');
                        return false;
                    }
                    
                    // Check terms agreement
                    const termsCheckbox = document.getElementById('terms_agreed');
                    if (termsCheckbox && !termsCheckbox.checked) {
                        e.preventDefault();
                        termsCheckbox.focus();
                        alert('You must agree to the terms and conditions.');
                        return false;
                    }
                    
                    // Check required fields
                    const requiredFields = form.querySelectorAll('[required]');
                    let isValid = true;
                    requiredFields.forEach(field => {
                        if (!field.value.trim()) {
                            isValid = false;
                            field.classList.add('is-invalid');
                        } else {
                            field.classList.remove('is-invalid');
                        }
                    });
                    
                    if (!isValid) {
                        e.preventDefault();
                        alert('Please fill in all required fields.');
                        return false;
                    }
                    
                    // Show loading state
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Submitting...';
                        submitBtn.disabled = true;
                    }
                });
            }
            
            // Rating stars hover effect
            const ratingStars = document.querySelectorAll('.rating-stars label');
            ratingStars.forEach(star => {
                star.addEventListener('mouseover', function() {
                    const value = this.getAttribute('for').replace('star', '');
                    highlightStars(value);
                });
                
                star.addEventListener('mouseout', function() {
                    const checked = document.querySelector('.rating-stars input:checked');
                    if (checked) {
                        highlightStars(checked.value);
                    } else {
                        resetStars();
                    }
                });
            });
            
            function highlightStars(value) {
                ratingStars.forEach(star => {
                    const starValue = star.getAttribute('for').replace('star', '');
                    if (starValue <= value) {
                        star.style.color = '#ffc107';
                    } else {
                        star.style.color = '#ddd';
                    }
                });
            }
            
            function resetStars() {
                ratingStars.forEach(star => {
                    star.style.color = '#ddd';
                });
            }
        });
    </script>
</body>
</html>